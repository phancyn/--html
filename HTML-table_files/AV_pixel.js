// @adr/adriver-viewability/pixel/legacy v0.0.35
var AdriverViewabilityPixel=function(){"use strict";function e(e,i){for(var s=0;s<i.length;s++){var n=i[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,t(n.key),n)}}function i(e,i,s){return(i=t(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e}function t(e){var i=function(e,i){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==typeof i?i:i+""}var s;!function(e){e.OnPage="onpage",e.SameDomainFrame="samedomainiframe",e.CrossDomainFrame="crossdomainframe"}(s||(s={}));var n,r=function(){return t=function e(){if(function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"_location",void 0),i(this,"_topWin",void 0),i(this,"_topRef",void 0),e._instance)return e._instance;e._instance=this,this.analyzeLocation()},(n=[{key:"analyzeLocation",value:function(){var e=window.location.href;if(window.top===window)this._location=s.OnPage,this._topWin=window;else{this._topWin=window.top;try{var i;null===(i=window.top)||void 0===i||i.location.href,e=this._topWin.location.href,this._location=s.SameDomainFrame}catch(i){this._location=s.CrossDomainFrame,e=window.document.referrer||window.location.href}}if(window.location.ancestorOrigins&&window.location.ancestorOrigins.length>0){var t=window.location.ancestorOrigins[window.location.ancestorOrigins.length-1];new URL(t).hostname!==new URL(e).hostname&&(e=t)}this._topRef=e}},{key:"topReferrer",get:function(){return this._topRef}},{key:"topWindow",get:function(){return this._topWin}},{key:"onPage",get:function(){return this._location===s.OnPage}},{key:"inCrossDomainFrame",get:function(){return this._location===s.CrossDomainFrame}},{key:"inSameDomainFrame",get:function(){return this._location===s.SameDomainFrame}}])&&e(t.prototype,n),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();i(r,"_instance",void 0),function(e){e[e.GetTopData=1]="GetTopData",e[e.Request=2]="Request"}(n||(n={}));var a=function e(i,t){if("loading"!==document.readyState){i=i.bind(t);var s=new r;if(s.inCrossDomainFrame){var a;window.addEventListener("message",(function e(t){var s=t.data,n=s.payload;10===s.type&&n&&(i(n),window.removeEventListener("message",e))})),null===(a=window.top)||void 0===a||a.postMessage({type:n.GetTopData},"*")}else{var o=s.topWindow.AFPS;o?o.subscribe(i):i(null)}}else document.addEventListener("DOMContentLoaded",(function(){return e(i,t)}),{once:!0})};function o(e,i,t,s,n){var r;if(this.browser=(r=navigator.userAgent,/trident/gi.test(r)||/msie/gi.test(r)?"IE":r.search(/Firefox/)>0?"Firefox":r.search(/Opera/)>0?"Opera":r.search(/Chrome/)>0?"Chrome":r.search(/Safari/)>0?"Safari":r.search(/Konqueror/)>0?"Konqueror":r.search(/Iceweasel/)>0?"Iceweasel":r.search(/SeaMonkey/)>0?"SeaMonkey":r.search(/Gecko/)>0?"Gecko":"Search Bot"),this.win=window,this.pixelLink=-1!==e.indexOf("/rle.cgi")?e.split("rle").join("json"):e,this.rnd=Math.round(1e8*Math.random()),this.isFrame=function(){var e,i,t={OnPage:1,Iframe:2,SameDomainIframe:3},s=0;try{if(window.top==window)return{frame:t.OnPage,topFrame:null,topFrameRef:window.document.referrer};for(e=window;e.parent!=e&&s<1e3;){if(i=e,e.parent.document.domain!=e.document.domain)return{frame:t.Iframe,topFrame:i,topFrameRef:i.document.referrer};e=e.parent,s++}return{frame:t.SameDomainIframe,topFrame:i,topFrameRef:e.location.href}}catch(e){}return i?{frame:t.Iframe,topFrame:i,topFrameRef:i.document.referrer}:{frame:t.Iframe,topFrame:e,topFrameRef:e.document.referrer}}(),this.topURL=this.parseURL(),this.eventLink=function(e,i,t){for(var s=e.substring(e.indexOf("?")+1).split("&"),n=[],r=0;r<s.length;r++){var a=s[r].split("=");a.length>1&&(n[a[0]]=a[1])}var o=n.bt||21,h=n.bid||0,l=n.ad||0,d=n.pid||0,c=n.rnd||i;return"https://ev.adriver.ru/cgi-bin/event.cgi?sid=1&ad="+l+"&pid="+d+"&bid="+h+"&bt="+o+"&loc="+t+"&rnd="+c+"&tuid=-1&type="}(e,this.rnd,this.topURL),this.zeroEvent=!0,this.viewabilityEvent=!0,this.isPermanent=!1,void 0!==i&&(0!==i&&(this.isPermanent=!0),3===i?(this.viewabilityEvent=!1,this.zeroEvent=!1):2===i&&(this.zeroEvent=!1)),this.delay=s||1e3,this.startTime=(new Date).getTime(),this.zeroEventTime=0,this.viewEventTime=0,this.dataNum=1,void 0!==n&&this.isNumeric(n)&&(this.dataNum=n),this.isStarted=!1,this.requestDone=!1,this.platform=function(){try{var e="desktop";return function(i){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4)))&&(e="mobile")}(navigator.userAgent||navigator.vendor||window.opera),e}catch(e){return"undefined"}}(),this.inApp=function(e){if("desktop"===e)return 1;if("mobile"===e){var i=window.navigator.userAgent,t=window.navigator.standalone,s=/safari/.test(i),n=/iphone|ipod|ipad/.test(i),r=i.includes("wv"),a=!!i.match(/(WebView|Android.*(wv|.0.0.0)|Linux; U; Android)/gi);return n&&!t&&!s||r||a?3:2}return 0}(this.platform),this.mraid_env=0,this.mraidVersion=-1,this.sdkName=0,this.sdkVersion=0,this.appID=0,this.advID=0,this.firstStart=!0,this.startTime=(new Date).getTime(),this.measurable=1,this.viewState=0,this.viewabilityWay=0,this.xpidReturned=!1,this.zeroEventWaiting=!1,this.viewEventWaiting=!1,this.secondaryEventWaiting=!1,this.element=void 0,this.elementPar=void 0,void 0!==t)if(3===this.isFrame.frame){for(var a,o=this.isFrame.topFrame.parent.document.getElementsByTagName("IFRAME"),h=0;h<o.length;h++)o[h].contentWindow===this.isFrame.topFrame&&(a=o[h]);void 0!==a?(this.element=a,this.win=this.isFrame.topFrame.parent.window):(this.isFrame.frame=2,this.isFrame.topFrame=null)}else"string"==typeof t?(this.elementPar=t,document.getElementById(t)?this.element=document.getElementById(t):this.element=void 0):0!==t&&(this.element=t);2==this.isFrame.frame&&this.isFrame.topFrame&&(this.win=this.isFrame.topFrame),this.isZeroSend=!1,this.isViewable=!1,this.eventsCallbacks={},this.measurable=1,2===this.isFrame.frame&&"IE"==this.browser&&(this.measurable=0),this.tabVisible=this.isTabVisible(),this.ancestorLength=function(){try{var e=window.location.ancestorOrigins;return void 0!==e?e.length:""}catch(e){return""}}(),this.historyLength="undefined"!=typeof history?history.length:"",this.lostPlacementChecked=!1,this.jsTrackers=[],this.jsTrackersNotLoaded=!1,this.imgTrackers=[],this.viewabilityTrackers=[],this.secondaryViewability=void 0,this.secondaryViewabilityTimeout=void 0,this.secondaryViewabilitySend=!1,this.isSecondaryVisible=!1,this.makeOtherParams=function(e){var i="";for(var t in e)void 0!==e[t]&&""!==e[t]&&(i+="&"+t+"="+e[t]);return i},this.startAFV()}return o.prototype.startAFV=function(){if(!this.isStarted)if(this.requestDone||(this.requestDone=!0,this.makeParamsRequest()),this.sendZeroEvent(),"mobile"===this.platform&&window.mraid&&(this.mraidVersion=parseInt(window.mraid.getVersion(),10)),2===this.mraidVersion||3===this.mraidVersion)this.viewabilityWay=2===this.mraidVersion?4:5,this.startMraidCheck();else{if(/in/.test(document.readyState)&&1===this.isFrame.frame&&void 0===this.element)return void this.onLoadF(this.startAFV.bind(this));if(2===this.isFrame.frame&&this.isFrame.topFrame&&/in/.test(this.isFrame.topFrame.document.readyState))return void this.onLoadF(this.startAFV.bind(this),this.isFrame.topFrame);if(1===this.isFrame.frame&&void 0===this.element&&void 0!==this.elementPar&&(document.getElementById(this.elementPar)?this.element=document.getElementById(this.elementPar):this.element=void 0),"IntersectionObserver"in window)this.viewabilityWay=1,this.startIOCheck();else if(2==this.isFrame.frame&&"IE"!==this.browser)this.viewabilityWay=2,this.startFrameCheck();else if(2!==this.isFrame.frame&&void 0!==this.element)this.viewabilityWay=3,this.startLocalCheck();else if(2!==this.isFrame.frame&&void 0===this.element&&!this.lostPlacementChecked)return this.lostPlacementChecked=!0,void this.lostPlacementFinder();this.jsTrackersNotLoaded&&this.loadJSTrackers(),this.isStarted=!0}},o.prototype.startMraidCheck=function(){function e(e){for(var i=arguments,t="",s=0;s<i.length;s++)switch(i[s]){case 115:t+="115="+this.viewabilityWay+";";break;case 116:t+="116="+this.appID+";";break;case 117:t+="117="+this.advID+";";break;case 118:t+="118="+this.sdkVersion+";";break;case 119:t+="119="+this.sdkName+";";break;case 161:t+="161="+Math.round(mraid.getSize().width)+";";break;case 162:t+="162="+Math.round(mraid.getSize().height)+";";break;case 165:t+="165="+this.getViewableProcWrapper()+";";break;case 176:t+="176="+((new Date).getTime()-this.startTime)+";";break;case 177:t+="177="+this.measurable+";";break;case 216:t+="216="+window.screen.width+";";break;case 217:t+="217="+window.screen.height+";";break;case 226:t+="226="+this.inApp+";"}return t}function i(i){i?this.viewTimer=setTimeout(function(){if(this.viewState>=50){var i=e.call(this,115,116,117,118,119,161,162,176,177,216,217,165,226);this.sendEvent(this.eventLink,53,i),mraid.removeEventListener("exposureChange",arguments.callee)}}.bind(this),1e3):(this.viewTime=void 0,void 0!==this.viewTimer&&clearTimeout(this.viewTimer))}if("undefined"!=typeof MRAID_ENV&&(this.mraid_env=!0,function(){try{this.mraid_env&&(this.sdkName=MRAID_ENV.sdk||0,this.sdkVersion=MRAID_ENV.sdkVersion||0,this.appID=MRAID_ENV.appId||0,this.advID=MRAID_ENV.ifa||0)}catch(e){this.sdkName=0,this.sdkVersion=0,this.appID=0,this.advID=0}}()),"loading"!==mraid.getState())switch(this.mraidVersion){case 2:mraid.isViewable()?setTimeout(function(){if(mraid.isViewable()&&this.firstStart){var i=e.call(this,115,116,117,118,119,161,162,176,177,216,217,165,226);this.sendEvent(this.eventLink,53,i),this.firstStart=!1}}.bind(this),1e3):mraid.addEventListener("viewableChange",function(i){i&&setTimeout(function(){if(mraid.isViewable()&&this.firstStart){var i=e.call(this,115,116,117,118,119,161,162,176,177,216,217,165,226);this.sendEvent(this.eventLink,53,i),mraid.removeEventListener("viewableChange",arguments.callee),this.firstStart=!1}}.bind(this),1e3)}.bind(this));break;case 3:mraid.addEventListener("exposureChange",(function(e){e>=50&&function(e){var t=this.viewState;this.viewState=e,t<50&&this.viewState>=50?i(!0):t>=50&&this.viewState<50&&i(!1)}()}))}else mraid.addEventListener("ready",checkMraidViewability)},o.prototype.startIOCheck=function(){var e;if(this.isStarted=!0,this.ioOptions={rootMargin:"0px",threshold:[0,.12,.25,.37,.5,.75,1]},this.ioElement,this.ioViewableProc=0,this.checkTab=function(){var e,i,t=this.isTabVisible();this.tabVisible!==t&&(t||void 0===(null===(e=this.ioElement)||void 0===e?void 0:e.visibleTimeout)?t&&this.ioViewableProc>=50&&void 0===(null===(i=this.ioElement)||void 0===i?void 0:i.visibleTimeout)&&!this.isViewable&&void 0!==this.handler&&(this.ioElement.visibleTimeout=setTimeout(this.handler,this.delay)):(clearTimeout(this.ioElement.visibleTimeout),this.ioElement.visibleTimeout=void 0));this.tabVisible=t},this.checkTab=this.checkTab.bind(this),this.addEvent(this.win,"visibilitychange",this.checkTab),this.isIOVisible=function(e,i){return e>=i},this.visibleTimerCallback=function(){clearTimeout(this.ioElement.visibleTimeout),this.ioElement.visibleTimeout=void 0,this.processChanges(this.observer.takeRecords()),this.ioElement.isVisible&&!this.isViewable&&this.isTabVisible()&&(this.sendViewEvent(53),this.stopObserving())},this.secondaryTimerCallback=function(){clearTimeout(this.secondaryViewabilityTimeout),this.secondaryViewabilityTimeout=void 0,this.processChanges(this.observer.takeRecords()),this.isSecondaryVisible&&!this.secondaryViewabilitySend&&this.isTabVisible()&&(this.secondaryViewabilitySend=!0,this.sendViewEvent(69),this.stopObserving())},this.processChanges=function(e){e.forEach(function(e){this.ioElement=e.target,this.ioElement.isVisible=this.isIOVisible(e.intersectionRatio,.5),this.ioViewableProc=Math.round(100*e.intersectionRatio),this.ioElement.isVisible&&void 0===this.ioElement.visibleTimeout&&!this.isViewable&&(this.ioElement.visibleTimeout=setTimeout(this.handler,this.delay)),void 0===this.ioElement.visibleTimeout||this.ioElement.isVisible||(clearTimeout(this.ioElement.visibleTimeout),this.ioElement.visibleTimeout=void 0),void 0!==this.secondaryViewability&&(this.isSecondaryVisible=this.isIOVisible(e.intersectionRatio,this.secondaryViewability.area/100),this.isSecondaryVisible&&void 0===this.secondaryViewabilityTimeout&&!this.secondaryViewabilitySend&&this.isTabVisible()&&(this.secondaryViewabilityTimeout=setTimeout(this.handlerSecond,1e3*this.secondaryViewability.time)),void 0===this.secondaryViewabilityTimeout||this.isSecondaryVisible&&this.isTabVisible()||(clearTimeout(this.secondaryViewabilityTimeout),this.secondaryViewabilityTimeout=void 0))}.bind(this))},this.clearViewabilityTimeout=function(e){clearTimeout(e),e=void 0},this.stopObserving=function(){!this.isPermanent&&this.xpidReturned&&this.isViewable&&(void 0===this.secondaryViewability||this.secondaryViewabilitySend)&&(this.removeEvent(this.win,"visibilitychange",this.checkTab),this.observer.unobserve(this.ioElement))},this.handler=this.bind(this.visibleTimerCallback,this),this.handlerSecond=this.bind(this.secondaryTimerCallback,this),this.pCHandler=this.bind(this.processChanges,this),this.observer=new IntersectionObserver(this.pCHandler,this.ioOptions),void 0!==this.element)e=this.element;else if(1!==this.isFrame.frame)if(0===this.win.document.documentElement.offsetHeight){var i=this.win.innerWidth,t=this.win.innerHeight,s=this.win.document.createElement("div");s.style.width=i+"px",s.style.height=t+"px",s.style.position="absolute",s.style.opacity=0,s.style.zIndex=-999999999,s.style.backgroundColor="transparent",s.style.top="0",s.style.left="0";this.win.addEventListener("resize",(function(e){s.style.width=e.target.innerWidth+"px",s.style.height=e.target.innerHeight+"px"})),this.win.document.documentElement.append(s),e=s}else e=this.win.document.documentElement;void 0!==e&&this.observer.observe(e)},o.prototype.startFrameCheck=function(){this.isStarted=!0,this.viewableCount=0,this.isCenterVisible=!1;var e="position:absolute;width:1px;height:1px;";"Firefox"===this.browser?e+="opacity:0.01;":e+="visibility:hidden;",this.frameInfo={topLeft:{isDrawn:!1,isVisible:!1,style:e+"top:0;left:0",timer:0},topRight:{isDrawn:!1,isVisible:!1,style:e+"top:0;right:0",timer:0},bottomLeft:{isDrawn:!1,isVisible:!1,style:e+"bottom:0;left:0",timer:0},bottomRight:{isDrawn:!1,isVisible:!1,style:e+"bottom:0;right:0",timer:0},centerTop:{isDrawn:!1,isVisible:!1,style:e+"top:25%;left:50%",timer:0},centerLeft:{isDrawn:!1,isVisible:!1,style:e+"top:50%;left:25%",timer:0},centerRight:{isDrawn:!1,isVisible:!1,style:e+"top:50%;left:75%",timer:0},centerBottom:{isDrawn:!1,isVisible:!1,style:e+"top:75%;left:50%",timer:0},center:{isDrawn:!1,isVisible:!1,style:e+"top:50%;left:50%",timer:0}},this.collectInfo=function(e){try{var i=JSON.parse(e.data);void 0!==i.AFV&&(!1===this.isCenterVisible&&"center"===i.frame&&"viewable"===i.state&&(this.isCenterVisible=!0,this.checkViwability()),!0===this.isCenterVisible&&"viewable"===i.state&&(this.frameInfo[i.frame].isVisible=!0,this.frameInfo[i.frame].timer=(new Date).getTime()))}catch(e){}},this.checkViwability=function(){var e=0;for(var i in this.frameInfo){var t=(new Date).getTime();!0===this.frameInfo[i].isVisible&&(t-this.frameInfo[i].timer>300?(this.frameInfo[i].isVisible=!1,"center"===i&&(this.isCenterVisible=!1)):e++)}if(this.viewableCount=e,!0!==this.isStarted||!0!==this.isCenterVisible||this.isViewable||(e>=6&&this.isTabVisible()?(this.sendViewEvent(53),this.stopAFV()):setTimeout(this.checkViwability.bind(this),100)),void 0!==this.secondaryViewability){var s=this.getViewableProc();s>=this.secondaryViewability.area/100&&void 0===this.secondaryViewabilityTimeout&&!this.secondaryViewabilitySend&&this.isTabVisible()&&(this.secondaryViewabilityTimeout=setTimeout(this.frameViwabilityComplete.bind(this),1e3*this.secondaryViewability.time,!1)),void 0!==this.secondaryViewabilityTimeout&&(s<this.secondaryViewability.area/100||!this.isTabVisible())&&(onsole.info("secondaryViewability clearTimeout"),clearTimeout(this.secondaryViewabilityTimeout),this.secondaryViewabilityTimeout=void 0)}},this.stopAFV=function(){this.isStarted&&!this.isPermanent&&this.isViewable&&(void 0===this.secondaryViewability||this.secondaryViewabilitySend)&&(!function(e,i){for(var t in e){var s=i.document.getElementById("AdriverFrameViewability_"+t);void 0!==s&&s.parentNode.removeChild(s),e[t].isDrawn=!1,e[t].isVisible=!1}}(this.frameInfo,this.win),this.removeEvent(this.win,"message",this.collectInfo.bind(this)),this.isStarted=!1)},this.drawFrames=function(e){for(var i in e){var t=this.win.document.createElement("iframe");t.id="AdriverFrameViewability_"+i,t.style.cssText=e[i].style,this.win.document.body.appendChild(t),e[i].isDrawn=!0,this.setFrameCode(i)}},this.setFrameCode=function(e){var i,t=(i=this.win.document.getElementById("AdriverFrameViewability_"+e)).contentWindow?i.contentWindow.document:i.contentDocument;void 0!==t&&(t.write('<script>function tick(e){var t=(new Date).getTime();0!=tick0&&(delay=t-tick0,delay<=100?(viewcount++,count>0&&count--,viewcount>=61&&0===count&&(parent.postMessage&&parent.postMessage(\'{"state": "viewable","AFV": "true","frame": "'+e+'"}\',"*"),count=6)):viewcount=0),tick0=t}function ticker(){requestAnimFrame(function(){ticker(),tick()})}window.requestAnimFrame=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var tick0=0,viewcount=0,count=0;ticker()<\/script>'),t.close())},this.frameViwabilityComplete=function(){var e=this.getViewableProc();!this.secondaryViewabilitySend&&e>=this.secondaryViewability.area/100&&(this.secondaryViewabilitySend=!0,(new Date).getTime(),this.startTime,this.sendViewEvent(69)),this.stopAFV()},this.drawFrames(this.frameInfo),this.addEvent(this.win,"message",this.collectInfo.bind(this))},o.prototype.startLocalCheck=function(){this.isStarted=!0,this.sendZeroEvent(),this.localTimer=null,this.controlLocalViewability=function(){if(this.isStarted){var e=this.checkLocalViewability(this.element,this.win);this.isViewable||(e>=.5&&this.isTabVisible()?this.localTimer||(this.localTimer=setTimeout(this.localViwabilityComplete.bind(this),this.delay,!0)):(clearTimeout(this.localTimer),this.localTimer=null)),void 0!==this.secondaryViewability&&(e>=this.secondaryViewability.area/100&&void 0===this.secondaryViewabilityTimeout&&!this.secondaryViewabilitySend&&this.isTabVisible()&&(this.secondaryViewabilityTimeout=setTimeout(this.localViwabilityComplete.bind(this),1e3*this.secondaryViewability.time,!1)),void 0!==this.secondaryViewabilityTimeout&&(e<this.secondaryViewability.area/100||!this.isTabVisible())&&(clearTimeout(this.secondaryViewabilityTimeout),this.secondaryViewabilityTimeout=void 0))}},this.checkLocalViewability=function(e,i){if(void 0!==e){var t=(n={w:(l=s=e).clientWidth,h:l.clientHeight},r=function(e,i,t){var s=e.getBoundingClientRect?function(e,i,t){var s=e.getBoundingClientRect();if(i){var n=c(t);return{left:s.left+n.sl,top:s.top+n.st}}return s}(e,i,t):function(e,i,t){for(var s,n=0,r=0,a=!1;e;)"fixed"===m(e,"position",t)&&(a=!0),n+=e.offsetTop,r+=e.offsetLeft,e=e.offsetParent;return i&&a?{left:r+(s=c(t)).sl,top:n+s.st}:i||a?{left:r,top:n}:{left:r-(s=c(t)).sl,top:n-s.st}}(e,i,t);return{left:Math.round(s.left),top:Math.round(s.top)}}(s,1,i),a=c(i),o=d("h",n,r,a),h=d("v",n,r,a),{S:n.w*n.h,curS:o*h});return t.curS/t.S}var s,n,r,a,o,h,l;function d(e,i,t,s){var n="v"===e,r=n?"h":"w",a=n?"top":"left",o=n?"ch":"cw",h=n?"st":"sl",l=0;return t[a]<s[h]?t[a]+i[r]>s[h]&&(l=t[a]+i[r]-s[h])>s[o]&&(l=s[o]):t[a]<s[h]+s[o]&&(l=t[a]+i[r]<=s[h]+s[o]?i[r]:s[h]+s[o]-t[a]),l}function c(e){var i={},t=e.document,s=t.body,n=t.documentElement,r="CSS1Compat"==t.compatMode;return i.cw=r&&n.clientWidth||e.innerWidth||s.clientWidth,i.ch=r&&n.clientHeight||e.innerHeight||s.clientHeight,i.sl=e.pageXOffset||r&&n.scrollLeft||s.scrollLeft,i.st=e.pageYOffset||r&&n.scrollTop||s.scrollTop,i}function m(e,i,t){return e.currentStyle?e.currentStyle[i]||"":t.getComputedStyle?t.getComputedStyle(e,null)[i]||"":void 0}},this.localViwabilityComplete=function(e){var i=this.checkLocalViewability(this.element,this.win);e?!this.isViewable&&i>=.5&&this.sendViewEvent(53):!this.secondaryViewabilitySend&&i>=this.secondaryViewability.area/100&&(this.secondaryViewabilitySend=!0,this.sendViewEvent(69)),this.stopLocalListen()},this.handler=this.bind(this.controlLocalViewability,this),this.startLocalListen=function(){this.addEvent(this.win,"scroll",this.handler),this.addEvent(this.win,"resize",this.handler),this.addEvent(this.win,"visibilitychange",this.handler)},this.stopLocalListen=function(){!this.isPermanent&&this.xpidReturned&&this.isViewable&&(void 0===this.secondaryViewability||this.secondaryViewabilitySend)&&(this.removeEvent(this.win,"scroll",this.handler),this.removeEvent(this.win,"resize",this.handler),this.removeEvent(this.win,"visibilitychange",this.handler))},this.startLocalListen(),this.controlLocalViewability(),setTimeout(this.handler,1e3)},o.prototype.onLoadF=function(e,i){var t=i||window;t.addEventListener?this.addEvent(t,"load",e):t.attachEvent("onload",e)},o.prototype.sendPixel=function(e){if(e=this.httplize(e).split("![rnd]").join(this.rnd),document.createElement&&document.body){var i=document.createElement("img");i.style.position="absolute",i.style.display="none",i.style.width=i.style.height="0px",i.style.display="none",i.setAttribute("referrerpolicy","no-referrer-when-downgrade"),i.src=e,document.body.appendChild(i)}else{var t=new Image;t.setAttribute("referrerpolicy","no-referrer-when-downgrade"),t.src=e}},o.prototype.httplize=function(e){return e=0==e.indexOf("http:")?e.split("http:").join("https:"):e,(/^\/\//.test(e)?"https:":"")+e},o.prototype.sendEvent=function(e,i,t){if(void 0!==e&&void 0!==i)return-1==e.indexOf("&type=")&&(e+="&type="),t&&-1==e.indexOf("&custom=")&&(e+="&custom="),e=e.split("&type=").join("&type="+i),t&&(e=e.split("&custom=").join("&custom="+t)),this.sendPixel(e),this},o.prototype.sendZeroEvent=function(){var e=this;this.zeroEventTime=0==this.zeroEventTime?(new Date).getTime()-this.startTime:this.zeroEventTime,this.xpidReturned?(this.zeroEvent&&!this.isZeroSend&&(2===this.isFrame.frame||3===this.isFrame.frame||1===this.isFrame.frame&&void 0!==this.element)&&(this.sendEvent(this.eventLink,0,"113="+(void 0!==this.secondaryViewability?"1":"0")+";161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";168="+this.isFrame.frame+";176="+this.zeroEventTime+";177="+this.isMeasurable()+";213="+this.ancestorLength+";214="+this.historyLength+";163="+this.topURL+";216="+window.screen.width+";217="+window.screen.height+";165="+this.getViewableProcWrapper()+";226="+this.inApp),this.isZeroSend=!0,this.loadImgPixels(this.imgTrackers)),(2===this.isFrame.frame||3===this.isFrame.frame||1===this.isFrame.frame&&void 0!==this.element)&&(this.callEvent("ZeroEvent"),this.isZeroSend=!0),a((function(i){if(i){var t=new URL(e.eventLink);t.searchParams.set("loc",i.loc),-1!==e.eventLink.indexOf("![rnd]")&&t.searchParams.set("rnd",e.rnd),e.eventLink=t.toString(),e.sendEvent(e.eventLink+"&cid=".concat(i.adrcid),77,"176="+((new Date).getTime()-e.startTime))}}))):this.zeroEventWaiting=!0},o.prototype.sendViewEvent=function(e){this.isViewable=!0,this.viewEventTime=0==this.viewEventTime?(new Date).getTime()-this.startTime:this.viewEventTime,this.xpidReturned?(this.viewabilityEvent&&53===e?(this.sendEvent(this.eventLink,53,"115="+this.viewabilityWay+";161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";176="+this.viewEventTime+";216="+window.screen.width+";217="+window.screen.height+";165="+this.getViewableProcWrapper()+";226="+this.inApp),this.loadImgPixels(this.viewabilityTrackers)):69===e&&this.sendEvent(this.eventLink,69,"161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";176="+this.viewEventTime+";216="+window.screen.width+";217="+window.screen.height+";165="+this.getViewableProcWrapper()+";226="+this.inApp),this.callEvent("ViewabilityEvent")):53===e?this.viewEventWaiting=!0:69===e&&(this.secondaryEventWaiting=!0)},o.prototype.addEvent=function(e,i,t){e.addEventListener?e.addEventListener(i,t,!1):e.attachEvent&&e.attachEvent("on"+i,t)},o.prototype.removeEvent=function(e,i,t){e.removeEventListener?e.removeEventListener(i,t,!1):e.detachEvent&&e.detachEvent("on"+i,t)},o.prototype.bind=function(e,i){return function(){return e.apply(i,arguments)}},o.prototype.getViewableProcWrapper=function(){var e=this.getViewableProc();return isNaN(e)?"-1":e},o.prototype.getViewableProc=function(){return void 0!==this.ioViewableProc?this.ioViewableProc:1!==this.isFrame.frame&&3!==this.isFrame.frame||void 0===this.checkLocalViewability?void 0!==this.viewableCount?this.viewableCount<2?0:this.viewableCount<3?12.5:this.viewableCount<5?25:this.viewableCount<6?37.5:this.viewableCount<7?50:this.viewableCount<8?75:100:0:Math.round(100*this.checkLocalViewability(this.element,this.win))},o.prototype.getViewability=function(){var e=this.getViewableProc();return 2===this.isFrame.frame&&"IE"===this.browser?"unmeasurable":this.isTabVisible()&&e>=50?"viewable":"unviewable"},o.prototype.isTabVisible=function(){return!this.win.document.hidden},o.prototype.isMeasurable=function(){return this.measurable},o.prototype.parseURL=function(){var e,i,t,s;if(-1!==(e=1==this.isFrame.frame?window.location.href:this.isFrame.topFrameRef).indexOf("doubleclick")&&-1!==e.indexOf("betweendigital"))for(var n in-1!==e.indexOf("doubleclick")?t="url":-1!==e.indexOf("betweendigital")&&(t="ref"),s=e.split("&"))"string"==typeof s[n]&&void 0!==(i=s[n].split("="))[1]&&""!==i[1]&&i[0]==t&&(e=i[1]);try{var r=window.location.ancestorOrigins;if(void 0===r)return encodeURIComponent(e);var a=(r=r.length>0?r[r.length-1]:void 0).split("/")[2];return e.split("/")[2]!==a&&""!==a?encodeURIComponent(r):encodeURIComponent(e)}catch(i){return encodeURIComponent(e)}},o.prototype.subscribe=function(e,i,t){e=e.bind(t),this.eventsCallbacks[i]=e},o.prototype.unsubscribe=function(e){this.eventsCallbacks[e]=null},o.prototype.callEvent=function(e){e in this.eventsCallbacks&&this.eventsCallbacks[e]()},o.prototype.callbackInit=function(e){try{this.eventLink=this.eventLink.split("&bt=").join("&xpid="+e.xpid+"&bt=")+this.makeOtherParams(e.extstr)}catch(e){}try{this.jsTrackers=e.jstracker}catch(e){this.jsTrackers=[]}try{this.imgTrackers=e.imgtracker}catch(e){this.imgTrackers=[]}try{this.viewabilityTrackers=e.viewtracker}catch(e){this.viewabilityTrackers=[]}try{this.isNumeric(e.cv.time)&&this.isNumeric(e.cv.area)&&(this.secondaryViewability=e.cv)}catch(e){this.secondaryViewability=void 0}this.xpidReturned=!0,this.zeroEventWaiting&&this.sendZeroEvent(),this.viewEventWaiting&&this.sendViewEvent(53),this.secondaryEventWaiting&&this.sendViewEvent(69),this.loadJSTrackers(),"IntersectionObserver"in window&&2==this.isFrame.frame&&void 0!==this.observer&&this.processChanges(this.observer.takeRecords())},o.prototype.makeParamsRequest=function(){try{var e,i=[],t=window.location.search.substring(1).split("&"),s="";for(var n in t)"number"!=typeof t[n]&&"string"!=typeof t[n]||(void 0!==(e=t[n].split("="))[1]&&"html_params"==e[0]?(s=-1==decodeURIComponent(e[1]).indexOf("xpid=")?"":"212="+decodeURIComponent(e[1]).split("xpid=")[1].split("&")[0],i.push(s)):void 0===e[1]||"seanceId"!=e[0]&&"rclid"!=e[0]||(s="212="+decodeURIComponent(e[1]),i.push(s)));var r=this.getBannerWidth(),a=this.getBannerHeight(),o="",h="";0!==r&&"undefined"!==r&&0!==a&&"undefined"!==a&&(o="&w="+r+"&h="+a,i.push("161="+r+";162="+a));try{var l="215="+encodeURIComponent(encodeURIComponent(window.navigator.userAgent));i.push(l)}catch(e){}if(i.length>0){h="custom=";for(n=0;n<i.length;n++)h+=i[n],n!==i.length-1&&(h+=";");-1!==this.pixelLink.indexOf("custom=")?this.pixelLink=this.pixelLink.split("custom=").join(h+";"):this.pixelLink+="&"+h}-1==this.pixelLink.indexOf("&tuid=")&&(this.pixelLink+="&tuid=1");var d=this.httplize(this.pixelLink.split("![rnd]").join(this.rnd)+o+"&tail256="+this.topURL+"&loc="+this.topURL);if("fetch"in window)fetch(d,{method:"GET",mode:"cors",credentials:"include",referrerPolicy:"no-referrer-when-downgrade"}).then((function(e){var i=e.headers.get("content-type");if(i&&i.includes("application/json"))return e.json();throw new TypeError("Not json returned")})).then(function(e){this.callbackInit(e)}.bind(this)).catch((function(e){console.log(e)}));else{var c,m=!1;window.XMLHttpRequest?void 0===(c=new window.XMLHttpRequest).responseType&&(m=!0):m=!0,m?(c=new window.XDomainRequest).onload=function(){this.callbackInit(JSON.parse(c.responseText),c)}.bind(this):c.onreadystatechange=function(){4===c.readyState&&this.callbackInit(JSON.parse(c.responseText),c)}.bind(this),c.open("GET",d,!0),c.withCredentials=!0,m||c.setRequestHeader("Content-Type","text/plain"),c.send()}}catch(e){console.log("xhr construction",e)}},o.prototype.getBannerWidth=function(){try{if(1===this.isFrame.frame){if(void 0===this.element){if(void 0===this.elementPar)return"undefined";document.getElementById(this.elementPar)?this.element=document.getElementById(this.elementPar):this.element=void 0}return void 0===this.element?"undefined":Math.round(this.element.getBoundingClientRect().width)}return Math.round(window.innerWidth)}catch(e){}return"undefined"},o.prototype.getBannerHeight=function(){try{if(1===this.isFrame.frame){if(void 0===this.element){if(void 0===this.elementPar)return"undefined";document.getElementById(this.elementPar)?this.element=document.getElementById(this.elementPar):this.element=void 0}return void 0===this.element?"undefined":Math.round(this.element.getBoundingClientRect().height)}return Math.round(window.innerHeight)}catch(e){}return"undefined"},o.prototype.isFullscreenMode=function(){try{return!!(window.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||window.screenTop>0&&window.screenLeft>0&&screen.height-window.outerHeight<30&&screen.height-window.outerHeight==2*window.screenTop&&screen.width-window.outerWidth<30||window.navigator.platform.toUpperCase().indexOf("MAC")>=0&&0==window.screenTop&&0==window.screenLeft)}catch(e){}return!1},o.prototype.setUnloadEvent=function(){try{this.sendEvent(this.eventLink,68,"161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";168="+this.isFrame.frame+";176="+lifeTime+";177="+this.isMeasurable()+";163="+this.topURL)}catch(e){}},o.prototype.lostPlacementFinder=function(){try{for(var e,i=document.getElementsByTagName("script"),t=0;t<i.length;t++)-1!=i[t].src.indexOf("AV_pixel.js")&&i[t].getAttribute("data-num")==this.dataNum&&((e=i[t].parentElement)instanceof HTMLBodyElement||e instanceof HTMLHeadElement)&&(e=null);null!=e&&(this.element=e,this.startAFV())}catch(e){}},o.prototype.loadJSTrackers=function(){try{if(this.jsTrackersNotLoaded=!1,this.jsTrackers.length>0)for(var e=0;e<this.jsTrackers.length;e++){var i=this.win.document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("charset","windows-1251"),i.setAttribute("src",this.httplize(this.jsTrackers[e].split("![rnd]").join(Math.round(9999999*Math.random())))),1!==this.isFrame.frame?this.win.document.documentElement.appendChild(i):1==this.isFrame.frame&&void 0!==this.element?this.element.appendChild(i):this.jsTrackersNotLoaded=!0}}catch(e){}},o.prototype.loadImgPixels=function(e){for(var i=0;i<e.length;i++)this.sendPixel(e[i].split("![rnd]").join(Math.round(9999999*Math.random())))},o.prototype.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},window.adriverviewabilitypixel=window.adriverviewabilitypixel||{},window.adriverviewabilitypixel.v=window.adriverviewabilitypixel.v||[],window.adriverviewabilitypixel.v.push=function(e){try{e.call()}catch(e){}},window.adriverviewabilitypixel.checkCalls=function(){for(var e=0;e<window.adriverviewabilitypixel.v.length;e++)if(void 0===window.adriverviewabilitypixel.v[e].called)try{window.adriverviewabilitypixel.v[e].call(),window.adriverviewabilitypixel.v[e].called=!0}catch(e){}},window.adriverviewabilitypixel.checkCalls(),window.adriverviewabilitypixel.getParametersAndStart=function(){for(var e=document.getElementsByTagName("script"),i=[],t=0,s=0;s<e.length;s++){var n={};if(-1!=e[s].src.indexOf("AV_pixel.js")&&(t++,!e[s].getAttribute("data-num"))){if(e[s].setAttribute("data-num",t),n.sPixel=e[s].getAttribute("data-pixel"),n.sPlacement=e[s].getAttribute("data-placement"),n.numberOfScripts=t,!n.sPixel||!n.sPlacement){var r=e[s].src.split("?")[1];if(r)for(var s in r=r.split("&"))if("string"==typeof r[s]){var a=r[s].split("=");if(void 0!==(v=a[1]))switch(a[0]){case"pixel":n.sPixel||(n.sPixel=decodeURIComponent(v));break;case"placement":n.sPlacement||(n.sPlacement=decodeURIComponent(v))}}}if(n.sPlacement||(n.sPlacement=e[s].parentElement,(n.sPlacement instanceof HTMLBodyElement||n.sPlacement instanceof HTMLHeadElement)&&(n.sPlacement=null)),"string"==typeof n.sPlacement&&"string"==typeof n.sPixel){n.sPlacement=n.sPlacement.split(", "),n.sPixel=n.sPixel.split(", ");for(s=0;s<n.sPlacement.length;s++)void 0!==n.sPixel[s]&&i.push({sPixel:n.sPixel[s],sPlacement:n.sPlacement[s],numberOfScripts:n.numOfScripts})}else i.push(n)}}for(s=0;s<i.length;s++)void 0!==i[s].sPixel&&(i[s].sPlacement?new o(i[s].sPixel,0,i[s].sPlacement,1e3,i[s].numberOfScripts):new o(i[s].sPixel,0,0,1e3,i[s].numberOfScripts))},window.adriverviewabilitypixel.getParametersAndStart(),o}();
